-title = ""
-title << @communication.newsletter.name+"&nbsp;: ".html_safe if @communication.newsletter
-title << @communication.name
-title <<" [Distribué]" if @communication.distributed?
-title = title.html_safe
-content_for(:title, title)
%h1=title
.toolbar
  =link_to("Retour", user_url(@communication.client))
  =link_to("Modifier", edit_communication_url(@communication))
  -unless @communication.distributed?
    =link_to("Importer les cibles", populate_communication_url(@communication))    
    =link_to("Supprimer les cibles", clear_communication_url(@communication), :method => :delete, "data-confirm" => "Sûr ?")
  -unless @communication.newsletter
    =link_to("Voir la page", message_url(@communication.key), :target => "_blank")
  =link_to("Voir le PDF", communication_url(@communication, :format => :pdf))
.toolbar
  -if @communication.testables.count > 0
    =link_to("Test e-mail", distribute_communication_url(@communication, :only => :email), :method => :post)
    =link_to("Test fax", distribute_communication_url(@communication, :only => :fax), :method => :post)
    =link_to("Test complet", distribute_communication_url(@communication), :method => :post)
  -if @communication.distributable?
    -#=link_to("Effectuer l'envoi pour les non-envoyés", distribute_communication_url(@communication, :mode => "unsent"), :method => :post, "data-confirm" => "Sûr(e) ?")
    =link_to("Envoi e-mail", distribute_communication_url(@communication, :mode => "real", :only => :email), :method => :post, "data-confirm" => "Sûr(e) ?")
    =link_to("Envoi fax", distribute_communication_url(@communication, :mode => "real", :only => :fax), :method => :post, "data-confirm" => "Sûr(e) ?")
    =link_to("Envoi complet", distribute_communication_url(@communication, :mode => "real"), :method => :post, "data-confirm" => "Sûr(e) ?")


-if @communication.newsletter
  %h2 
    Newsletter
    -if current_user.administrator
      =link_to(@communication.newsletter.name, edit_newsletter_url(@communication.newsletter))
  .toolbar
    =link_to("Ajouter un article", new_article_url(:communication_id => @communication.id))
  =render :partial => "articles/article", :collection => @communication.articles
-else
  %h2 Flyer
  =image_tag(@communication.flyer.url(:web))


%h2 Détails
-fields = [:name, :planned_on, :sender_email, :sender_label, :reply_to_email, :subject, :target_url]
-if @communication.newsletter
  -fields += [:title, :introduction, :conclusion]
-else
  -fields += [:message, :unreadable_label, :unsubscribe_label, :message_label]
%table.details
  -for x in fields
    %tr.field.input
      %td.label=Communication.human_attribute_name(x)
      %td.span=beautify(@communication.send(x).to_s)



-if @communication.touchables.count > 0
  %h2 Cibles
  =list :touchables
